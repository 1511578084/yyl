(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-59f7237f"],{1508:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sitesearchE"},[n("div",{staticClass:"wrapper",on:{click:function(t){t.stopPropagation()}}},[n("form",{attrs:{action:"/"}},[n("van-search",{ref:"input",staticClass:"siteSearch",attrs:{"show-action":"",placeholder:"请输入网点名称或编码"},on:{search:t.onSearch,cancel:t.onCancel,input:t.onSearch},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),n("ul",{staticClass:"search_Show"},t._l(t.siteList,(function(e){return n("li",{key:e.id,staticClass:"van-cell van-cell--clickable van-dropdown-item__option",on:{click:function(n){return t.selectAgentStore(e)}}},[n("div",[t._v(t._s(e.name))]),n("div",{staticClass:"tip"},[t._v(t._s(e.code))])])})),0)])])},r=[],i=(n("d3b7"),n("795b")),a=n.n(i),s=n("967e"),c=n.n(s),u=(n("96cf"),n("a417")),d={name:"siteSearch",props:{formData:{type:Object,default:function(){}}},data:function(){return{positioning:!1,keyword:"",siteList:[]}},mounted:function(){this.$nextTick((function(){try{var t=document.getElementsByClassName("van-field__control")[document.getElementsByClassName("van-field__control").length-1];t.focus()}catch(e){}}))},methods:{onSearch:function(){var t;return c.a.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c.a.awrap(Object(u["b"])({name:this.keyword,enabled:1}));case 2:t=e.sent,t&&(this.siteList=t);case 4:case"end":return e.stop()}}),null,this,null,a.a)},onCancel:function(){this.$parent.onSiteCancel()},selectAgentStore:function(t){this.$parent.onSiteSelected(t)}}},l=d,f=(n("f51f"),n("2877")),p=Object(f["a"])(l,o,r,!1,null,"50f0837f",null);e["a"]=p.exports},"17ec":function(t,e,n){},9646:function(t,e,n){"use strict";var o=n("17ec"),r=n.n(o);r.a},"9f52":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"item-wrapper"},[n("van-field",{staticClass:"__textarea",attrs:{formatter:t.disableEmoji,"format-trigger":"onBlur",autosize:"",type:"textarea",rows:"3",maxlength:"200",placeholder:"请输入...","show-word-limit":""},model:{value:t.form.replyContent,callback:function(e){t.$set(t.form,"replyContent",e)},expression:"form.replyContent"}}),n("van-field",{staticClass:"__upload",attrs:{label:"","label-width":"155","input-align":"left"},scopedSlots:t._u([{key:"input",fn:function(){return[n("van-uploader",{attrs:{accept:"image/*","max-count":"1","after-read":t.afterRead,"before-read":t.beforeRead},on:{delete:t.deletePic},model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})]},proxy:!0}])}),n("van-cell",{attrs:{"is-link":"",title:"驻场","input-align":"right",readonly:""},on:{click:t.getSearch},scopedSlots:t._u([{key:"input",fn:function(){return[n("div",{staticClass:"right-part",staticStyle:{color:"rgb(150, 151, 153)"}},[t._v(" "+t._s(t.form.residentSiteName)+" ")])]},proxy:!0},{key:"icon",fn:function(){return[n("van-icon",{staticStyle:{height:"16px","margin-right":"3px","margin-top":"3px",width:"16px"},attrs:{name:t.signImg}})]},proxy:!0}]),model:{value:t.form.residentSiteName,callback:function(e){t.$set(t.form,"residentSiteName",e)},expression:"form.residentSiteName"}}),n("van-cell",{attrs:{title:"定位",icon:"location-o","input-align":"right",clickable:"",name:"currentLocation"},on:{click:t.setLocation},scopedSlots:t._u([{key:"input",fn:function(){},proxy:!0},{key:"right-icon",fn:function(){return[t.form.address?t._e():n("div",{staticClass:"view-color"},[t.positioning?n("van-loading",{attrs:{type:"spinner",size:"16"}}):t._e(),t._v(" 点击获取 ")],1),n("div",{staticClass:"right-part",staticStyle:{color:"rgb(150, 151, 153)"}},[t._v(t._s(t.form.address))])]},proxy:!0}])}),n("div",{staticClass:"footer"},[n("van-button",{staticClass:"submit-button",attrs:{block:"",type:"info"},on:{click:t.submitFeedback}},[t._v(" 提交 ")])],1),n("baidu-map",{attrs:{ak:"Kqxw3hKvBtjG8ssUpWO65wrk2Hq4YFds"}}),t.siteShow?n("siteSearch",{on:{onCancel:t.onSiteCancel,onSelected:t.onSiteSelected}}):t._e()],1)},r=[],i=(n("99af"),n("caad"),n("a434"),n("b0c0"),n("a9e3"),n("d3b7"),n("2532"),n("f499")),a=n.n(i),s=n("967e"),c=n.n(s),u=(n("96cf"),n("795b")),d=n.n(u),l=n("fec8"),f=n("f9d0"),p=n("a417"),h=n("7c8d"),m=n.n(h),g=n("1508"),b=n("bbd2"),w=n.n(b),S={name:"Search",components:{BaiduMap:l["a"],siteSearch:g["a"]},data:function(){return{signImg:w.a,signResult:{},jobCode:"",type:0,appJobUserViewId:0,form:{userViewId:0,id:0,jobCode:"",replyContent:"",pics:[],feedbackType:0,resident:0,residentSiteCode:"",residentSiteName:"",longitudeOfCurrentLocation:"",latitudeOfCurrentLocation:"",address:""},siteShow:!1,fileList:[],positioning:!1}},computed:{},created:function(){},mounted:function(){this.jobCode=this.$route.query.jobCode,this.type=this.$route.query.type,this.appJobUserViewId=this.$route.query.appJobUserViewId,this.form.userViewId=this.$route.query.appJobUserViewId,this.form.jobCode=this.$route.query.jobCode,this.form.residentSiteName=this.$route.query.siteName,this.form.residentSiteCode=this.$route.query.siteCode},destroyed:function(){},methods:{deletePic:function(t,e,n){try{this.form.pics.splice(e.index,1)}catch(o){}},beforeRead:function(t){return"image/jpeg"===t.type.toLowerCase()||"image/jpg"===t.type.toLowerCase()||"image/png"===t.type.toLowerCase()||(this.$toast("图片格式只支持jpg、jpeg、png"),!1)},setLocation:function(){var t=this;if(!navigator.userAgent.includes("baohe"))return this.form.address="上海",this.form.latitudeOfCurrentLocation="1254554.26",void(this.form.longitudeOfCurrentLocation="1254554.26");this.positioning=!0,this.getLocation().then((function(e){var n=t,o="https://api.map.baidu.com/reverse_geocoding/v3/?ak=Kqxw3hKvBtjG8ssUpWO65wrk2Hq4YFds&output=json&coordtype=".concat(t.inIos?"wgs84ll":"bd09ll","&location=").concat(e.latitude,",").concat(e.longitude);n.$jsonp(o).then((function(t){n.form.address=t.result.formatted_address,n.form.latitudeOfCurrentLocation=e.latitude,n.form.longitudeOfCurrentLocation=e.longitude,setTimeout((function(){n.positioning=!1}),500)})).catch((function(){t.positioning=!1,t.$toast("定位失败")}))})).catch((function(){t.positioning=!1,t.$toast("定位失败")}))},getLocation:function(){return new d.a((function(t,e){if(window.zt&&window.zt.getLocation)window.zt.getLocation({success:function(e){t(e)},fail:function(){e()}});else{var n=new BMap.Geolocation;n.getCurrentPosition((function(e){t(e)}))}}))},afterRead:function(t,e,n){return c.a.async((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,c.a.awrap(this.afterReadFile(t,e,n,1));case 2:case"end":return o.stop()}}),null,this,null,d.a)},afterReadFile:function(t,e,n,o){var r,i,a,s=this;return c.a.async((function(e){while(1)switch(e.prev=e.next){case 0:if(t.status="uploading",t.message="上传中...","file"!==n){e.next=7;break}i=t.type,r=t,e.next=11;break;case 7:return i=t.file.type,e.next=10,c.a.awrap(this.compressorImg(t));case 10:r=e.sent;case 11:if(!this.signResult.sign){e.next=15;break}return e.next=14,c.a.awrap(Object(p["l"])(r,this.signResult,i).then((function(e){e.status?(t.status="done ",s.form.pics.push(e.result.fileName)):(t.status="failed",t.message="上传失败",s.$toast("上传图片失败，请重新上传:"+e.message))})));case 14:return e.abrupt("return");case 15:return e.next=17,c.a.awrap(Object(p["a"])());case 17:if(a=e.sent,!a){e.next=22;break}return this.signResult=a,e.next=22,c.a.awrap(Object(p["l"])(r,this.signResult,i).then((function(e){e.status?(t.status="done ",s.form.pics.push(e.result.fileName)):(t.status="failed",t.message="上传失败",s.fileList.splice(s.fileList.length-1,1),s.$toast("上传图片失败，请重新上传:"+e.message))})));case 22:case"end":return e.stop()}}),null,this,null,d.a)},compressorImg:function(t){return new d.a((function(e){new m.a(t.file,{quality:.6,success:function(t){e(t)},error:function(){this.$toast("图片压缩失败")}})}))},getFilePublicUrl:function(t){var e;return c.a.async((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,c.a.awrap(Object(p["f"])({remoteFileId:t,userCode:this.userInfo.userCode}));case 2:return e=n.sent,n.abrupt("return",e);case 4:case"end":return n.stop()}}),null,this,null,d.a)},getSearch:function(){this.form.siteCode||(this.siteShow=!0)},onSiteCancel:function(){this.siteShow=!1},onSiteSelected:function(t){this.form.siteCode!==t.code&&(this.form.residentSiteName=t.name,this.form.residentSiteCode=t.code,this.form.resident=1,this.siteShow=!1)},submitFeedback:function(){var t;return c.a.async((function(e){while(1)switch(e.prev=e.next){case 0:if(this.form.replyContent||0!==this.form.pics.length||this.form.residentSiteCode||this.form.address){e.next=3;break}return this.$toast("内容为空，不可提交"),e.abrupt("return");case 3:if(!this.form.residentSiteCode||this.form.address){e.next=6;break}return this.$toast("驻场网点需定位，否则无法进行驻场打卡"),e.abrupt("return");case 6:return this.form.residentSiteCode?this.form.resident=1:this.form.resident=0,t=JSON.parse(a()(this.form)),t.longitudeOfCurrentLocation?(t.longitudeOfCurrentLocation=Number(t.longitudeOfCurrentLocation),t.latitudeOfCurrentLocation=Number(t.latitudeOfCurrentLocation)):(t.longitudeOfCurrentLocation=null,t.latitudeOfCurrentLocation=null),e.next=11,c.a.awrap(Object(f["d"])(t));case 11:this.$toast("提交成功"),this.$router.back();case 13:case"end":return e.stop()}}),null,this,null,d.a)}},beforeRouteLeave:function(t,e,n){n()}},y=S,C=(n("9646"),n("2877")),k=Object(C["a"])(y,o,r,!1,null,"b6635ac0",null);e["default"]=k.exports},bbd2:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAjVJREFUWEft1kmojnEUx/HPJRkWhpCwQDYUG5EsDMmQIrFDESWShYXCQoYNsZAksiJkZ2FYmBcSyRQWFiIURaYFkbGT89btuu/7PE/33m7Kf/uc/znf8zvnf87TpJNPUyfH9x/gn1OgN9ZjLkaiG17gInbhWdWeqqLAQuzDkDpBPmEL9uBnWZCyAJHx6XR6GftxC98wGiuwJL9vxbb2BBiM+xiA5s67ogci8ziLcSyzn4prZSDKKLATG3AJM9AzZV6aAHewOhWJEq3NnpjZXgA3MSEzPJHyr8F3vMUgvMao7I+HWZpQp7AXyijwFMMxCTfwHn0xB+dxD2OxAKfwIzPvj3dFKpQBiKATMR638Sudxmt4lc0ZTboKh/L7V/RqLwW2Y3NFgLM5K4oEKLULQu6o6/wKCkzB1cLolAIIP7PwBndLlGAHNpUJHjZleqDmK2yj/kU9ULMrxVAFoOawHsCZLFHLwNGoR/ClNaIigDFYh2F4kAPoeZ1X0CjjeJ7RQ3+dRgCTcQHdm936iD4tAGYnYGv+wza2ZAyt2JyVAK5gWr7tvViZatSc1OZAo8xjj7xMg1aTbaTAE4zAdARMnOU4kKp0OMBhLMMjzMPjhIiRfBLjchJ2mAIDcT3/fGL+L8K5jDYUH5qt4noQbSpBOO2H47l4YrNtxO5SD/yPUZsBwkmX/NWKfRA9czB3fm3rdVgJWjqOjXc0V3G86yjJ5wI12kWBCopXNy2ahNU9VrzxH6DTFfgN2VeGIaMMlLAAAAAASUVORK5CYII="},cd27:function(t,e,n){},f51f:function(t,e,n){"use strict";var o=n("cd27"),r=n.n(o);r.a},f9d0:function(t,e,n){"use strict";n.d(e,"n",(function(){return i})),n.d(e,"m",(function(){return a})),n.d(e,"k",(function(){return s})),n.d(e,"e",(function(){return c})),n.d(e,"c",(function(){return u})),n.d(e,"b",(function(){return d})),n.d(e,"a",(function(){return l})),n.d(e,"f",(function(){return f})),n.d(e,"j",(function(){return p})),n.d(e,"l",(function(){return h})),n.d(e,"h",(function(){return m})),n.d(e,"d",(function(){return g})),n.d(e,"g",(function(){return b})),n.d(e,"i",(function(){return w})),n.d(e,"o",(function(){return S})),n.d(e,"p",(function(){return y})),n.d(e,"q",(function(){return C}));var o=n("51be"),r=n("b775");function i(t){return Object(r["a"])({url:"".concat(o["a"],"/app/queryHomePageTaskInfo"),method:"POST",data:t,isErrorMsgPop:!0})}function a(t){return Object(r["a"])({url:"".concat(o["a"],"/app/myTodoTaskList"),method:"POST",data:t,isErrorMsgPop:!0})}function s(t){return Object(r["a"])({url:"".concat(o["a"],"/app/myFinishedTaskList"),method:"POST",data:t,isErrorMsgPop:!0})}function c(t){return Object(r["a"])({url:"".concat(o["a"],"/app/copyToMeTaskList"),method:"POST",data:t,isErrorMsgPop:!0})}function u(t){return Object(r["a"])({url:"".concat(o["a"],"/app/myTodoTaskDetail"),method:"POST",data:t,isErrorMsgPop:!0})}function d(t){return Object(r["a"])({url:"".concat(o["a"],"/app/myFinishedTaskDetail"),method:"POST",data:t,isErrorMsgPop:!0})}function l(t){return Object(r["a"])({url:"".concat(o["a"],"/app/copyToMeDetail "),method:"POST",data:t,isErrorMsgPop:!0})}function f(t){return Object(r["a"])({url:"".concat(o["a"],"/app/copyToMeTaskSite"),method:"POST",data:t,isErrorMsgPop:!0})}function p(t){return Object(r["a"])({url:"".concat(o["a"],"/app/myFinishedTaskSite"),method:"POST",data:t,isErrorMsgPop:!0})}function h(t){return Object(r["a"])({url:"".concat(o["a"],"/app/myTodoTaskSite"),method:"POST",data:t,isErrorMsgPop:!0})}function m(t){return Object(r["a"])({url:"".concat(o["a"],"/pc/queryTaskFeedback"),method:"POST",data:t,isErrorMsgPop:!0})}function g(t){return Object(r["a"])({url:"".concat(o["a"],"/pc/addReply"),method:"POST",data:t,isErrorMsgPop:!0})}function b(t){return Object(r["a"])({url:"".concat(o["a"],"/pc/task/completeJobSite/error "),method:"POST",data:t,isErrorMsgPop:!0})}function w(t){return Object(r["a"])({url:"".concat(o["a"],"/pc/task/jobSite/info"),method:"POST",data:t,isErrorMsgPop:!0})}function S(t){return Object(r["a"])({url:"".concat(o["a"],"/pc/task/all "),method:"POST",data:t,isErrorMsgPop:!0})}function y(t){return Object(r["a"])({url:"".concat(o["a"],"/pc/task/check"),method:"POST",data:t,isErrorMsgPop:!0})}function C(t){return Object(r["a"])({url:"".concat(o["a"],"/mobile/task/transfer/1"),method:"POST",data:t,isErrorMsgPop:!0})}}}]);